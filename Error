# Script wrapper pour System-Health.ps1
$ErrorActionPreference = "Stop"

try {
    # VÃ©rifier si le module est dÃ©jÃ  chargÃ©
    if (-not (Get-Module -Name CyberArk-Common)) {
        # Importer le module
        Import-Module ".\System Health\CyberArk-Common.psm1" -Force -DisableNameChecking
    }
    
    # Chemin absolu du script Ã  exÃ©cuter
    $scriptPath = ".\System Health\System-Health.ps1"
    
    # PrÃ©parer la commande avec les paramÃ¨tres dans le format correct
    $command = "$scriptPath -PVWAURL 'https://accessqa.st.com/PasswordVault' -DisableSSLVerify -AllComponentTypes -AllServers -OutputObject"
    
    # ExÃ©cuter le script en utilisant Invoke-Expression
    $output = Invoke-Expression $command
    
    # Exporter les rÃ©sultats en CSV
    $output | Export-Csv -Path "C:\tmp\SystemHealth.csv" -NoTypeInformation
    
    Write-Output "Rapport SystemHealth exportÃ© avec succÃ¨s"
} catch {
    Write-Error "Erreur lors de l'exÃ©cution du script System-Health: $_"
    throw
}
